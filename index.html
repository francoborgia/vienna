<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vienna Guide â€” Plus</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#6a85b6,#bac8e0);min-height:100vh;color:#333}
    .app-container{max-width:420px;margin:0 auto;background:#fff;min-height:100vh;position:relative;overflow:hidden}
    .header{background:linear-gradient(135deg,#1a237e,#3949ab);color:#fff;padding:22px;text-align:center}
    .header h1{font-size:24px;margin-bottom:6px}
    .header p{font-size:13px;opacity:.95}
    .nav-tabs{display:flex;background:#f6f7fb;border-bottom:1px solid #e5e7eb}
    .nav-tab{flex:1;padding:14px 10px;text-align:center;background:none;border:none;cursor:pointer;font-size:14px;transition:.2s;border-bottom:3px solid transparent}
    .nav-tab.active{background:#fff;border-bottom-color:#1a237e;color:#1a237e;font-weight:600}
    .content{padding:18px;height:calc(100dvh - 200px);overflow-y:auto}
    .card{background:#fff;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 6px 14px rgba(0,0,0,.08);transition:transform .18s, box-shadow .18s}
    .card:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.12)}
    .card-header{display:flex;align-items:center;margin-bottom:8px}
    .card-icon{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:12px;font-size:19px}
    .attraction-icon{background:#1a237e;color:#fff}
    .parking-icon{background:#2e7d32;color:#fff}
    .electric-icon{background:#1565c0;color:#fff}
    .food-icon{background:#8b5cf6;color:#fff}
    .extra-icon{background:#ef6c00;color:#fff}
    .card-title{font-size:16px;font-weight:700;color:#222}
    .card-subtitle{font-size:12px;color:#6b7280;margin-top:2px}
    .card-description{font-size:14px;color:#4b5563;line-height:1.45;margin:10px 0}
    .card-info{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .tag{background:#f3f4f6;padding:4px 8px;border-radius:999px;font-size:12px;color:#6b7280}
    .tag.free{background:#dcfce7;color:#166534}
    .tag.paid{background:#fee2e2;color:#991b1b}
    .tag.fast{background:#dbeafe;color:#1e40af}
    .tag.walk{background:#e0f2fe;color:#075985}
    .tag.pt{background:#ecfccb;color:#3f6212}
    .tag.drive{background:#fee2e2;color:#9f1239}
    .distance{font-size:12px;color:#2e7d32;font-weight:700}
    .stars{color:#f59e0b;font-size:14px}
    .hidden{display:none}
    .search-box{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:10px;margin-bottom:14px;font-size:14px}
    .filters{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
    .filter-btn{padding:8px 12px;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;font-size:12px;cursor:pointer;transition:.2s}
    .filter-btn.active{background:#1a237e;color:#fff;border-color:#1a237e}
    .floating-btn{position:fixed;bottom:20px;right:20px;width:56px;height:56px;background:#1a237e;border:none;border-radius:50%;color:#fff;font-size:24px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.25);transition:.2s;z-index:1000}
    .floating-btn:hover{transform:scale(1.08)}
    .notice{background:#e3f2fd;padding:10px;border-radius:10px;margin:10px 0;border-left:4px solid #2196f3;font-size:13px;color:#0f172a}
    /* Weather */
    .weather{display:flex;gap:10px;align-items:center;background:#eef2ff;border:1px solid #c7d2fe;border-left:4px solid #6366f1;padding:10px;border-radius:12px;margin:10px 0}
    .weather .now{display:flex;align-items:center;gap:10px}
    .weather .temp{font-size:22px;font-weight:800}
    .weather .desc{font-size:12px;color:#374151}
    .hourly{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;margin-top:8px}
    .hchip{min-width:64px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:10px;padding:6px;text-align:center;font-size:12px}
    /* Detail pages */
    .detail-page{position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:9999;transform:translateX(100%);transition:transform .28s ease;overflow-y:auto}
    .detail-page.active{transform:translateX(0)}
    .detail-header{background:linear-gradient(135deg,#1a237e,#3949ab);color:#fff;padding:20px;position:sticky;top:0}
    .back-btn{position:absolute;left:14px;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.2);border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;font-size:18px}
    .detail-content{padding:18px}
    .detail-image{width:100%;height:200px;object-fit:cover;border-radius:12px;margin:12px 0}
    .detail-title{font-size:22px;font-weight:800;color:#111;margin:6px 0}
    .detail-subtitle{font-size:14px;color:#6b7280;margin-bottom:12px}
    .detail-text{font-size:15px;color:#374151;line-height:1.6;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:6px}
    .info{background:#f8fafc;padding:14px;border-radius:10px;text-align:center}
    .info .i{font-size:22px;margin-bottom:6px}
    .go-btn{width:100%;background:linear-gradient(135deg,#2e7d32,#43a047);color:#fff;border:none;padding:14px;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;margin-top:16px}
    /* GPS panel */
    .gps-panel{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0 2px}
    .switch{display:inline-flex;align-items:center;gap:8px;font-size:13px}
    .switch input{width:36px;height:20px}
  </style>
</head>
<body>
<div class="app-container">
  <div class="header">
    <h1>ğŸ» Vienna Guide</h1>
    <p>Storia imperiale, arte, caffÃ¨ â€” meteo + GPS con salvataggio</p>
  </div>

  <div class="nav-tabs" role="tablist" aria-label="Sezioni">
    <button class="nav-tab active" role="tab" aria-current="page" onclick="showTab('attractions', event)">ğŸ›ï¸ Attrazioni</button>
    <button class="nav-tab" role="tab" onclick="showTab('food', event)">ğŸ½ï¸ Ristoranti</button>
    <button class="nav-tab" role="tab" onclick="showTab('parking', event)">ğŸ…¿ï¸ Parcheggi</button>
    <button class="nav-tab" role="tab" onclick="showTab('electric', event)">ğŸ”Œ Elettrico</button>
    <button class="nav-tab" role="tab" onclick="showTab('extra', event)">ğŸ¢ Extra</button>
  </div>

  <div class="content">
    <!-- METEO -->
    <div id="weather" class="weather">
      <div class="now">
        <div id="w-icon">â›…</div>
        <div>
          <div class="temp" id="w-temp">--Â°C</div>
          <div class="desc" id="w-desc">Meteo in caricamentoâ€¦</div>
        </div>
      </div>
    </div>
    <div id="hourly" class="hourly"></div>

    <!-- GPS controls -->
    <div class="gps-panel">
      <label class="switch" title="Usa la posizione del dispositivo">
        <input type="checkbox" id="gps-toggle"/>
        <span>Usa GPS automatico</span>
      </label>
      <div class="actions" id="gps-actions">
        <button class="primary" onclick="retryGPS()">ğŸ”„ Riprova GPS</button>
        <button onclick="selectManualLocation()">ğŸ¯ Imposta posizione manuale</button>
      </div>
    </div>
    <div class="notice" id="location-status">ğŸ“ Inizializzazione posizioneâ€¦</div>

    <!-- ATTRAZIONI -->
    <section id="attractions-content">
      <input class="search-box" placeholder="ğŸ” Cerca attrazioni (es. SchÃ¶nbrunn)" oninput="filterContentDeb(this.value,'attractions')"/>
      <div class="filters">
        <button class="filter-btn active" onclick="filterByType('all','attractions',event)">Tutte</button>
        <button class="filter-btn" onclick="filterByType('imperiale','attractions',event)">Imperiali</button>
        <button class="filter-btn" onclick="filterByType('museo','attractions',event)">Musei</button>
        <button class="filter-btn" onclick="filterByType('panorama','attractions',event)">Panorami</button>
        <button class="filter-btn" onclick="filterByType('architettura','attractions',event)">Architettura</button>
      </div>

      <article class="card attraction-card" data-type="architettura" onclick="openDetail('stephansdom')">
        <div class="card-header"><div class="card-icon attraction-icon">â›ª</div><div><div class="card-title">Cattedrale di Santo Stefano</div><div class="card-subtitle">Stephansdom â€¢ Centro storico</div></div></div>
        <p class="card-description">Il simbolo gotico di Vienna con tetto policromo. Torre sud con vista sulla Innere Stadt.</p>
        <div class="card-info"><span class="tag free">Navata gratis</span><span class="tag">â­ 4.7</span><span class="distance" id="distance-stephansdom">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card attraction-card" data-type="imperiale" onclick="openDetail('schoenbrunn')">
        <div class="card-header"><div class="card-icon attraction-icon">ğŸ°</div><div><div class="card-title">Palazzo di SchÃ¶nbrunn</div><div class="card-subtitle">Residenza imperiale â€¢ Hietzing</div></div></div>
        <p class="card-description">Residenza estiva degli Asburgo con giardini barocchi, Gloriette e zoo storico.</p>
        <div class="card-info"><span class="tag paid">Tour a pagamento</span><span class="tag">â­ 4.8</span><span class="distance" id="distance-schoenbrunn">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card attraction-card" data-type="museo" onclick="openDetail('belvedere')">
        <div class="card-header"><div class="card-icon attraction-icon">ğŸ–¼ï¸</div><div><div class="card-title">Belvedere</div><div class="card-subtitle">Museo d'arte â€¢ Klimt</div></div></div>
        <p class="card-description">Belvedere Superiore/Inferiore con â€œIl Bacioâ€ di Klimt e arte austriaca.</p>
        <div class="card-info"><span class="tag paid">Biglietto</span><span class="tag">â­ 4.7</span><span class="distance" id="distance-belvedere">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card attraction-card" data-type="panorama" onclick="openDetail('prater')">
        <div class="card-header"><div class="card-icon attraction-icon">ğŸ¡</div><div><div class="card-title">Prater & Ruota Panoramica</div><div class="card-subtitle">Wurstelprater â€¢ Leopoldstadt</div></div></div>
        <p class="card-description">Parco storico con la Riesenrad del 1897 e viali alberati.</p>
        <div class="card-info"><span class="tag free">Parco pubblico</span><span class="tag">â­ 4.6</span><span class="distance" id="distance-prater">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card attraction-card" data-type="museo" onclick="openDetail('mq')">
        <div class="card-header"><div class="card-icon attraction-icon">ğŸ›ï¸</div><div><div class="card-title">MuseumsQuartier</div><div class="card-subtitle">Leopold Museum, mumok</div></div></div>
        <p class="card-description">Grande polo culturale con corti vivaci, arte moderna e caffÃ¨.</p>
        <div class="card-info"><span class="tag paid">Musei</span><span class="tag">â­ 4.6</span><span class="distance" id="distance-mq">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card attraction-card" data-type="architettura" onclick="openDetail('hundert')">
        <div class="card-header"><div class="card-icon attraction-icon">ğŸ¨</div><div><div class="card-title">Hundertwasserhaus</div><div class="card-subtitle">Architettura organica â€¢ LandstraÃŸe</div></div></div>
        <p class="card-description">Colori vivaci, linee curve e terrazze alberate: un'icona pop.</p>
        <div class="card-info"><span class="tag free">Visita esterna</span><span class="tag">â­ 4.5</span><span class="distance" id="distance-hundert">ğŸ“ Calcoloâ€¦</span></div>
      </article>
    </section>

    <!-- FOOD -->
    <section id="food-content" class="hidden">
      <input class="search-box" placeholder="ğŸ” Cerca ristoranti (es. schnitzel, fast food)" oninput="filterContentDeb(this.value,'food')"/>
      <div class="filters">
        <button class="filter-btn active" onclick="filterByType('all','food',event)">Tutti</button>
        <button class="filter-btn" onclick="filterByType('tipico','food',event)">Tipici</button>
        <button class="filter-btn" onclick="filterByType('fast','food',event)">Fast Food</button>
        <button class="filter-btn" onclick="filterByType('caffÃ¨','food',event)">CaffÃ¨ storici</button>
      </div>

      <article class="card food-card" data-type="tipico" onclick="openDetail('figlmueller')">
        <div class="card-header"><div class="card-icon food-icon">ğŸ¥©</div><div><div class="card-title">FiglmÃ¼ller BÃ¤ckerstraÃŸe</div><div class="card-subtitle">Schnitzel gigante â€¢ Centro</div></div></div>
        <p class="card-description">Il piÃ¹ celebre schnitzel viennese. Meglio prenotare.</p>
        <div class="card-info"><span class="stars">â˜…â˜…â˜…â˜…â˜† 4.6</span><span class="distance" id="distance-figlmueller">ğŸ“ Calcoloâ€¦</span><span class="tag" id="mode-figlmueller">â€”</span></div>
      </article>

      <article class="card food-card" data-type="tipico" onclick="openDetail('plachutta')">
        <div class="card-header"><div class="card-icon food-icon">ğŸ²</div><div><div class="card-title">Plachutta Wollzeile</div><div class="card-subtitle">Tafelspitz â€¢ Centro</div></div></div>
        <p class="card-description">Brodo e bollito alla viennese, servizio classico.</p>
        <div class="card-info"><span class="stars">â˜…â˜…â˜…â˜…â˜† 4.5</span><span class="distance" id="distance-plachutta">ğŸ“ Calcoloâ€¦</span><span class="tag" id="mode-plachutta">â€”</span></div>
      </article>

      <article class="card food-card" data-type="caffÃ¨" onclick="openDetail('cafecentral')">
        <div class="card-header"><div class="card-icon food-icon">â˜•</div><div><div class="card-title">CafÃ© Central</div><div class="card-subtitle">CaffÃ¨ storico â€¢ Ring</div></div></div>
        <p class="card-description">Saloni storici, torte e atmosfera letteraria.</p>
        <div class="card-info"><span class="stars">â˜…â˜…â˜…â˜…â˜† 4.6</span><span class="distance" id="distance-cafecentral">ğŸ“ Calcoloâ€¦</span><span class="tag" id="mode-cafecentral">â€”</span></div>
      </article>

      <article class="card food-card" data-type="fast" onclick="openDetail('mcd-stephansplatz')">
        <div class="card-header"><div class="card-icon food-icon">ğŸ”</div><div><div class="card-title">McDonald's Stephansplatz</div><div class="card-subtitle">Fast food â€¢ Centro</div></div></div>
        <p class="card-description">Classico fast food in pieno centro.</p>
        <div class="card-info"><span class="stars">â˜…â˜…â˜…â˜†â˜† 3.9</span><span class="distance" id="distance-mcd-stephansplatz">ğŸ“ Calcoloâ€¦</span><span class="tag" id="mode-mcd-stephansplatz">â€”</span></div>
      </article>

      <article class="card food-card" data-type="fast" onclick="openDetail('bk-prater')">
        <div class="card-header"><div class="card-icon food-icon">ğŸŸ</div><div><div class="card-title">Burger King â€“ Prater</div><div class="card-subtitle">Fast food â€¢ Leopoldstadt</div></div></div>
        <p class="card-description">Comodo se stai visitando il Prater.</p>
        <div class="card-info"><span class="stars">â˜…â˜…â˜…â˜†â˜† 3.8</span><span class="distance" id="distance-bk-prater">ğŸ“ Calcoloâ€¦</span><span class="tag" id="mode-bk-prater">â€”</span></div>
      </article>
    </section>

    <!-- PARCHEGGI -->
    <section id="parking-content" class="hidden">
      <input class="search-box" placeholder="ğŸ” Cerca parcheggi (es. Park & Ride)" oninput="filterContentDeb(this.value,'parking')"/>
      <div class="filters">
        <button class="filter-btn active" onclick="filterByType('all','parking',event)">Tutti</button>
        <button class="filter-btn" onclick="filterByType('parkride','parking',event)">Park & Ride</button>
        <button class="filter-btn" onclick="filterByType('garage','parking',event)">Garage</button>
        <button class="filter-btn" onclick="filterByType('strada','parking',event)">Su strada</button>
      </div>

      <article class="card parking-card" data-type="parkride" onclick="openDetail('pr-erdberg')">
        <div class="card-header"><div class="card-icon parking-icon">ğŸ…¿ï¸</div><div><div class="card-title">Park & Ride Erdberg</div><div class="card-subtitle">Linea U3 â€¢ Est</div></div></div>
        <p class="card-description">Lascia l'auto e raggiungi il centro con la metro U3.</p>
        <div class="card-info"><span class="tag paid">Tariffa giornaliera</span><span class="tag">ğŸš‡ U3</span><span class="distance" id="distance-pr-erdberg">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card parking-card" data-type="garage" onclick="openDetail('mq-garage')">
        <div class="card-header"><div class="card-icon parking-icon">ğŸ¢</div><div><div class="card-title">Garage MuseumsQuartier</div><div class="card-subtitle">Sotto MQ â€¢ Centro</div></div></div>
        <p class="card-description">Garage coperto centrale, accesso diretto ai musei.</p>
        <div class="card-info"><span class="tag paid">Oraria</span><span class="tag">Coperto</span><span class="distance" id="distance-mq-garage">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card parking-card" data-type="strada" onclick="openDetail('kurzpark')">
        <div class="card-header"><div class="card-icon parking-icon">ğŸš</div><div><div class="card-title">Kurzparkzone (su strada)</div><div class="card-subtitle">Zone a sosta breve â€¢ App</div></div></div>
        <p class="card-description">In molte zone interne la sosta Ã¨ a tempo. Controlla orari e durata sull'app Handyparken.</p>
        <div class="card-info"><span class="tag">â±ï¸ Tempo limitato</span><span class="tag">ğŸ“± App Handyparken</span><span class="distance">ğŸ“ varie zone</span></div>
      </article>
    </section>

    <!-- ELETTRICO -->
    <section id="electric-content" class="hidden">
      <input class="search-box" placeholder="ğŸ” Cerca stazioni di ricarica" oninput="filterContentDeb(this.value,'electric')"/>
      <div class="filters">
        <button class="filter-btn active" onclick="filterByType('all','electric',event)">Tutte</button>
        <button class="filter-btn" onclick="filterByType('fast','electric',event)">Ricarica rapida</button>
        <button class="filter-btn" onclick="filterByType('garage','electric',event)">In garage</button>
      </div>
      <div class="notice">â„¹ï¸ Le tariffe e l'accesso possono variare. Verifica sempre sull'app del gestore.</div>

      <article class="card parking-card" data-type="fast" onclick="openDetail('wien-energie-rathaus')">
        <div class="card-header"><div class="card-icon electric-icon">âš¡</div><div><div class="card-title">Wien Energie â€“ Rathaus</div><div class="card-subtitle">Ricarica AC/DC â€¢ Centro</div></div></div>
        <p class="card-description">Accesso con app Wien Energie o RFID.</p>
        <div class="card-info"><span class="tag fast">AC/DC</span><span class="tag">ğŸ’³ App/RFID</span><span class="distance" id="distance-wien-energie-rathaus">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card parking-card" data-type="garage" onclick="openDetail('garage-karteis')">
        <div class="card-header"><div class="card-icon electric-icon">ğŸ”‹</div><div><div class="card-title">Garage KÃ¤rntner StraÃŸe â€“ EV</div><div class="card-subtitle">Sottosuolo â€¢ Centro</div></div></div>
        <p class="card-description">Stalli EV centrali, comodo per Stephansplatz.</p>
        <div class="card-info"><span class="tag">AC</span><span class="tag">Garage</span><span class="distance" id="distance-garage-karteis">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card parking-card" data-type="fast" onclick="openDetail('tesla-vienna')">
        <div class="card-header"><div class="card-icon electric-icon">âš¡</div><div><div class="card-title">Tesla Supercharger â€“ Vienna area</div><div class="card-subtitle">Rete Tesla â€¢ Extraurbano</div></div></div>
        <p class="card-description">Verifica disponibilitÃ  e potenza dall'app Tesla.</p>
        <div class="card-info"><span class="tag fast">DC</span><span class="tag">ğŸš— Tesla</span><span class="distance" id="distance-tesla-vienna">ğŸ“ Calcoloâ€¦</span></div>
      </article>
    </section>

    <!-- EXTRA -->
    <section id="extra-content" class="hidden">
      <div class="filters">
        <button class="filter-btn active" onclick="filterByType('all','extra',event)">Tutte</button>
        <button class="filter-btn" onclick="filterByType('parco','extra',event)">Parchi divertimento</button>
        <button class="filter-btn" onclick="filterByType('panorama','extra',event)">Panorami/Torri</button>
        <button class="filter-btn" onclick="filterByType('avventura','extra',event)">Avventura</button>
      </div>

      <article class="card extra-card" data-type="parco" onclick="openDetail('prater')">
        <div class="card-header"><div class="card-icon extra-icon">ğŸ¢</div><div><div class="card-title">Wurstelprater</div><div class="card-subtitle">Luna park storico â€¢ Centro-est</div></div></div>
        <p class="card-description">Attrazioni classiche, ruota panoramica, street food.</p>
        <div class="card-info"><span class="tag walk" id="mode-prater">â€”</span><span class="distance" id="distance-prater-extra">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card extra-card" data-type="panorama" onclick="openDetail('donauturm')">
        <div class="card-header"><div class="card-icon extra-icon">ğŸ—¼</div><div><div class="card-title">Donauturm</div><div class="card-subtitle">Torre sul Danubio â€¢ Vista cittÃ </div></div></div>
        <p class="card-description">Piattaforma panoramica con ristorante girevole.</p>
        <div class="card-info"><span class="tag" id="mode-donauturm">â€”</span><span class="distance" id="distance-donauturm">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card extra-card" data-type="avventura" onclick="openDetail('kahlenberg-park')">
        <div class="card-header"><div class="card-icon extra-icon">ğŸ§—</div><div><div class="card-title">Waldseilpark Kahlenberg</div><div class="card-subtitle">Parco avventura sugli alberi</div></div></div>
        <p class="card-description">Percorsi tra gli alberi sopra Vienna. Perfetto per famiglie attive.</p>
        <div class="card-info"><span class="tag" id="mode-kahlenberg-park">â€”</span><span class="distance" id="distance-kahlenberg-park">ğŸ“ Calcoloâ€¦</span></div>
      </article>

      <article class="card extra-card" data-type="panorama" onclick="openDetail('rax-seilbahn')">
        <div class="card-header"><div class="card-icon extra-icon">ğŸš¡</div><div><div class="card-title">Rax-Seilbahn (fuori cittÃ )</div><div class="card-subtitle">Funivia alpina â€¢ ~80 km</div></div></div>
        <p class="card-description">La funivia piÃ¹ vicina a Vienna per panorami alpini (Hirschwang an der Rax). Gita di giornata.</p>
        <div class="card-info"><span class="tag" id="mode-rax-seilbahn">â€”</span><span class="distance" id="distance-rax-seilbahn">ğŸ“ Calcoloâ€¦</span></div>
      </article>
    </section>
  </div>

  <button class="floating-btn" onclick="openMap()" title="Apri mappa">ğŸ“</button>
</div>

<!-- DETTAGLI (stesse sezioni giÃ  fornite prima; omesse qui per brevitÃ ) -->
<!-- Puoi riutilizzare i blocchi detail-* che ti ho giÃ  dato. -->

<script>
/* ===== Ambiente / Stato ===== */
const IS_SANDBOX = location.href.startsWith('about:') || location.origin === 'null' || (()=>{
  try { return window.self !== window.top; } catch { return true; }
})();

let userLocation = null;         // posizione corrente usata per i calcoli
let useGPS = true;               // preferenza utente
const LS_KEYS = {
  useGPS: 'vg.useGPS',
  manualPos: 'vg.manualPos'      // {lat,lng}
};

/* ===== Dati POI ===== */
const attractions = {
  'stephansdom': {lat:48.20849,lng:16.37208},
  'schoenbrunn': {lat:48.18452,lng:16.31218},
  'belvedere':   {lat:48.19112,lng:16.38005},
  'prater':      {lat:48.21627,lng:16.39929},
  'mq':          {lat:48.20387,lng:16.35854},
  'hundert':     {lat:48.20703,lng:16.39213},
  'donauturm':       {lat:48.24026,lng:16.40938},
  'kahlenberg-park': {lat:48.27035,lng:16.33339},
  'rax-seilbahn':    {lat:47.70274,lng:15.78037}
};
const points = {
  'pr-erdberg': {lat:48.19279,lng:16.41385,type:'parkride'},
  'mq-garage':  {lat:48.20358,lng:16.35820,type:'garage'},
  'wien-energie-rathaus': {lat:48.21350,lng:16.35723,type:'fast'},
  'garage-karteis': {lat:48.20566,lng:16.37043,type:'garage'},
  'tesla-vienna':   {lat:48.18333,lng:16.33333,type:'fast'}
};
const food = {
  'figlmueller':        {lat:48.2089,lng:16.3761,type:'tipico',stars:4.6},
  'plachutta':          {lat:48.2080,lng:16.3769,type:'tipico',stars:4.5},
  'cafecentral':        {lat:48.2101,lng:16.3647,type:'caffÃ¨',stars:4.6},
  'mcd-stephansplatz':  {lat:48.2082,lng:16.3725,type:'fast',stars:3.9},
  'bk-prater':          {lat:48.2167,lng:16.3978,type:'fast',stars:3.8}
};

/* ===== UtilitÃ  ===== */
const debounce=(fn,d=200)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),d)}};
const filterContentDeb = debounce(filterContent,200);

function setStatus(text,color){const el=document.getElementById('location-status');if(!el)return;el.style.color=color||'#0f172a';el.textContent=text}
function dist(a,b){const R=6371,dLat=(b.lat-a.lat)*Math.PI/180,dLng=(b.lng-a.lng)*Math.PI/180;const s1=Math.sin(dLat/2),s2=Math.sin(dLng/2);const c=2*Math.atan2(Math.sqrt(s1*s1+Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*s2*s2),Math.sqrt(1-(s1*s1+Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*s2*s2)));const km=R*c;return km<1?Math.round(km*1000)+'m':km.toFixed(1)+'km'}
function upd(id,txt){const el=document.getElementById('distance-'+id);if(el)el.textContent='ğŸ“ '+txt;const el2=document.getElementById('detail-distance-'+id);if(el2)el2.textContent=txt;const mapExtra={'prater':'prater-extra'};if(mapExtra[id]){const elx=document.getElementById('distance-'+mapExtra[id]);if(elx)elx.textContent='ğŸ“ '+txt}}
function toKm(text){return text.endsWith('m')?parseInt(text)/1000:parseFloat(text)}
function suggestMode(km){if(km<=1)return{label:'ğŸš¶â€â™‚ï¸ A piedi',class:'walk'};if(km<=3)return{label:'ğŸ›´/ğŸš‡ Monopattino o metro',class:'pt'};if(km<=12)return{label:'ğŸš‡/ğŸš— Mezzi o auto',class:'pt'};return{label:'ğŸš— Auto/treno (lontano)',class:'drive'}}
function updMode(id){const c=attractions[id]||food[id]||points[id];if(!c||!userLocation)return;const km=toKm(dist(userLocation,c));const tag=document.getElementById('mode-'+id);if(!tag)return;const m=suggestMode(km);tag.className='tag '+m.class;tag.textContent=m.label}

/* ===== Meteo (Open-Meteo) ===== */
async function fetchWeather(lat,lng){try{const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true&hourly=temperature_2m,precipitation,weathercode&timezone=auto`;const r=await fetch(url);const j=await r.json();if(j.current_weather){const t=Math.round(j.current_weather.temperature);const w=j.current_weather.weathercode;document.getElementById('w-temp').textContent=t+'Â°C';document.getElementById('w-desc').textContent=codeToDesc(w);document.getElementById('w-icon').textContent=codeToIcon(w)}const hourly=document.getElementById('hourly');hourly.innerHTML='';const times=j.hourly.time,temps=j.hourly.temperature_2m,prec=j.hourly.precipitation,codes=j.hourly.weathercode;const now=new Date();let printed=0;for(let i=0;i<times.length&&printed<12;i++){const ts=new Date(times[i]);if(ts>=now){const chip=document.createElement('div');chip.className='hchip';const hh=ts.getHours().toString().padStart(2,'0');chip.innerHTML=`<div>${hh}:00</div><div style="font-size:18px">${codeToIcon(codes[i])}</div><div>${Math.round(temps[i])}Â°C</div><div style="font-size:11px">${prec[i]>0?prec[i].toFixed(1)+'mm':''}</div>`;hourly.appendChild(chip);printed++}}}catch(e){document.getElementById('w-desc').textContent='Meteo non disponibile'}}
function codeToDesc(c){const m={0:'Sereno',1:'Poco nuvoloso',2:'Variabile',3:'Nuvoloso',45:'Nebbia',48:'Brina',51:'Pioviggine',53:'Pioviggine',55:'Pioviggine forte',61:'Pioggia',63:'Pioggia',65:'Pioggia forte',71:'Neve',80:'Rovesci',95:'Temporale'};return m[c]||'Condizioni variabili'}
function codeToIcon(c){if([0].includes(c))return'â˜€ï¸';if([1,2].includes(c))return'â›…';if([3,45,48].includes(c))return'â˜ï¸';if([51,53,55,61,63,65,80].includes(c))return'ğŸŒ§ï¸';if([71].includes(c))return'ğŸŒ¨ï¸';if([95].includes(c))return'â›ˆï¸';return'ğŸŒ¤ï¸'}

/* ===== Persistenza ===== */
function loadPrefs(){
  const storedUseGPS = localStorage.getItem(LS_KEYS.useGPS);
  if (storedUseGPS !== null) useGPS = storedUseGPS === 'true';
  const mp = localStorage.getItem(LS_KEYS.manualPos);
  if (mp) {
    try {
      const obj = JSON.parse(mp);
      if (isFinite(obj?.lat) && isFinite(obj?.lng)) manualPos = {lat: +obj.lat, lng: +obj.lng};
    } catch {}
  }
}
function saveUseGPS(val){ localStorage.setItem(LS_KEYS.useGPS, String(val)); }
let manualPos = null;
function saveManualPos(pos){ manualPos = pos; localStorage.setItem(LS_KEYS.manualPos, JSON.stringify(pos)); }

/* ===== GPS / Flusso iniziale ===== */
function renderGPSActions(onlyManual=false){
  const el=document.getElementById('gps-actions'); if(!el) return;
  el.innerHTML = (onlyManual? '' : `<button class="primary" onclick="retryGPS()">ğŸ”„ Riprova GPS</button>`)
               + ` <button onclick="selectManualLocation()">ğŸ¯ Imposta posizione manuale</button>`;
}
function retryGPS(){ initializeGPS(); }
function selectManualLocation(){
  const presets = [
    {name:'Stephansplatz (centro)', lat:48.20849, lng:16.37208},
    {name:'SchÃ¶nbrunn', lat:48.18452, lng:16.31218},
    {name:'Prater', lat:48.21627, lng:16.39929}
  ];
  const label = presets.map((p,i)=>`${i+1}) ${p.name}`).join('\n');
  const pick = prompt(`Seleziona una posizione:\n${label}\n\nOppure inserisci "lat,lng"`, '1');
  let lat,lng;
  if (!pick) return;
  if (pick.includes(',')){
    const [a,b] = pick.split(',').map(x=>parseFloat(x.trim()));
    if (isFinite(a)&&isFinite(b)){ lat=a; lng=b; }
  } else {
    const idx = parseInt(pick,10)-1;
    if (presets[idx]){ lat=presets[idx].lat; lng=presets[idx].lng; }
  }
  if (!isFinite(lat)||!isFinite(lng)) return alert('Coordinate non valide.');
  setManualPosition({lat,lng});
}
function setManualPosition(pos){
  userLocation = {lat:pos.lat, lng:pos.lng};
  saveManualPos(userLocation);
  setStatus('ğŸ“ Posizione manuale impostata e salvata','#1e40af');
  calcAll(); fetchWeather(userLocation.lat,userLocation.lng);
}

function initializeGPS(){
  const toggle = document.getElementById('gps-toggle');
  // In sandbox: forziamo manuale
  if (IS_SANDBOX){
    useGPS = false; if (toggle){ toggle.checked = false; toggle.disabled = true; }
    setStatus('â„¹ï¸ Sandbox/iframe: GPS disabilitato. Usa posizione manuale.','#b91c1c');
    const base = manualPos || {lat:48.20849,lng:16.37208};
    userLocation = base; calcAll(); fetchWeather(base.lat, base.lng);
    renderGPSActions(true);
    return;
  }

  // Lettura preferenza
  if (toggle) toggle.checked = !!useGPS;

  if (!useGPS){
    const base = manualPos || {lat:48.20849,lng:16.37208};
    userLocation = base;
    setStatus(manualPos? 'ğŸ“ Uso posizione manuale salvata' : 'â„¹ï¸ GPS disattivato: uso centro Vienna','#1e40af');
    calcAll(); fetchWeather(base.lat, base.lng); renderGPSActions(true);
    return;
  }

  // GPS abilitato dall'utente: verifica HTTPS/Geolocation
  if (!window.isSecureContext && location.hostname!=='localhost'){
    setStatus('âš ï¸ Non sei in HTTPS/localhost: GPS bloccato. Attiva HTTPS o passa a manuale.','#b91c1c');
    const base = manualPos || {lat:48.20849,lng:16.37208};
    userLocation = base; calcAll(); fetchWeather(base.lat, base.lng);
    renderGPSActions(true); // solo manuale utile qui
    return;
  }
  if (!navigator.geolocation){
    setStatus('âš ï¸ Questo browser non supporta il GPS. Uso manuale/centro Vienna.','#b91c1c');
    const base = manualPos || {lat:48.20849,lng:16.37208};
    userLocation = base; calcAll(); fetchWeather(base.lat, base.lng);
    renderGPSActions(true);
    return;
  }

  // Richiesta posizione
  setStatus('ğŸ”„ Rilevamento posizioneâ€¦','#ff9800');
  navigator.geolocation.getCurrentPosition((pos)=>{
    userLocation = {lat:pos.coords.latitude, lng:pos.coords.longitude};
    setStatus('âœ… GPS attivo - distanze precise','#4caf50');
    calcAll(); fetchWeather(userLocation.lat,userLocation.lng);
    renderGPSActions(false);
  }, (error)=>{
    const msgs={1:['ğŸ“ Accesso posizione negato','Abilita la localizzazione o usa manuale'],
                2:['ğŸ“¡ Posizione non disponibile','Spostati allâ€™aperto e riprova'],
                3:['â±ï¸ Timeout','Riprova piÃ¹ tardi']};
    const [m,d]=msgs[error?.code]||['âš ï¸ Errore GPS','Problema sconosciuto'];
    setStatus(`${m} â€” ${d}`,'#b45309');
    const base = manualPos || {lat:48.20849,lng:16.37208};
    userLocation = base; calcAll(); fetchWeather(base.lat, base.lng);
    renderGPSActions(true);
  }, {enableHighAccuracy:true, timeout:15000, maximumAge:600000});
}

/* ===== Mappe / Navigazione ===== */
function navigateTo(lat,lng,name,mode){const d=`${lat},${lng}`;const url=`https://www.google.com/maps/dir/?api=1&destination=${d}&travelmode=${mode||'driving'}&dir_action=navigate`;window.open(url,'_blank')}
function navigateSmart(lat,lng,name){const mode=(userLocation?(toKm(dist(userLocation,{lat,lng}))<=1?'walking':'driving'):'driving');navigateTo(lat,lng,name,mode)}
function openMap(){const c=userLocation||{lat:48.20849,lng:16.37208};window.open(`https://www.google.com/maps/search/?api=1&query=${c.lat},${c.lng}`,'_blank')}

/* ===== UI: Tabs / Dettagli / Filtri ===== */
function showTab(tab,ev){document.querySelectorAll('.nav-tab').forEach(b=>b.classList.remove('active'));if(ev&&ev.currentTarget)ev.currentTarget.classList.add('active');['attractions','food','parking','electric','extra'].forEach(s=>{document.getElementById(`${s}-content`).classList.toggle('hidden',s!==tab)});document.querySelector('.content').scrollTop=0}

function openDetail(id){
  const page=document.getElementById('detail-'+id);
  if(!page) return;
  // niente pushState in sandbox
  if(!IS_SANDBOX){ try{ history.pushState({detail:id},'',`#${id}`);}catch{} }
  page.classList.add('active'); document.body.style.overflow='hidden';
  const coord=attractions[id]||points[id]||food[id];
  const base=userLocation||{lat:48.20849,lng:16.37208};
  if(coord){ upd(id,dist(base,coord)); updMode(id); }
}
function closeDetail(){
  const active=document.querySelector('.detail-page.active');
  if(active) active.classList.remove('active');
  document.body.style.overflow='';
  if(!IS_SANDBOX && location.hash){ try{ history.pushState('',document.title,window.location.pathname+window.location.search);}catch{} }
}

function filterContent(q,section){
  const cls=section==='attractions'?'attraction-card':section==='food'?'food-card':section==='parking'?'parking-card':'extra-card';
  const cards=document.querySelectorAll(`.${cls}`);
  const qq=(q||'').toLowerCase();
  cards.forEach(c=>{const txt=c.innerText.toLowerCase();c.style.display=txt.includes(qq)?'':'none'});
}
function filterByType(type,section,ev){
  if(ev&&ev.currentTarget){
    const wrap=ev.currentTarget.closest('.filters');
    if(wrap) wrap.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    ev.currentTarget.classList.add('active');
  }
  const cls=section==='attractions'?'attraction-card':section==='food'?'food-card':section==='parking'?'parking-card':'extra-card';
  document.querySelectorAll(`.${cls}`).forEach(c=>{
    const t=c.getAttribute('data-type')||'all';
    c.style.display=(type==='all'||t===type)?'':'none';
  });
}

/* ===== Avvio ===== */
window.addEventListener('DOMContentLoaded', ()=>{
  loadPrefs();

  // inizializza toggle UI
  const toggle=document.getElementById('gps-toggle');
  if (IS_SANDBOX){
    if (toggle){ toggle.checked=false; toggle.disabled=true; }
  } else {
    if (toggle){ toggle.checked=!!useGPS; }
  }
  if (toggle){
    toggle.addEventListener('change', ()=>{
      useGPS = toggle.checked && !IS_SANDBOX;
      saveUseGPS(useGPS);
      initializeGPS();
    });
  }

  showTab('attractions');
  initializeGPS();

  if (!IS_SANDBOX) window.addEventListener('popstate', closeDetail);
});
</script>

<!-- ====== DETTAGLI (riutilizza i blocchi detail-* giÃ  passati) ======
     Per brevitÃ  non li ripeto qui: incolla tutti i <div id="detail-..."> che avevi.
     Funzionano invariati con questo file.                                  -->

</body>
</html>


